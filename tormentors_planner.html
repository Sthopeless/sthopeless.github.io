<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tormentors of Torghast</title>
  <link rel="stylesheet" href="tormentors_planner.css">
</head>
<body>
  <h1>Tormentors of Torghast - Spawn Planner</h1>
  <h3>Minions of the Cold Dark</h3>

  <div class="bosses">
    <h2>Select completed bosses</h2>
    <div class="boss-list" id="bossList"></div>
  </div>

  <div class="days-container" id="output"></div>

  <div class="footer">Made for Grim Batol players – Date: todayTime</div>

  <script>
    const bosses = [
      "Algel the Haunter",
      "Malleus Grakizz",
      "Gralebboih",
      "The Mass of Souls",
      "Manifestation of Pain",
      "Versya the Damned",
      "Zul'gath the Flayer",
      "Golmak The Monstrosity",
      "Sentinel Pyrophus",
      "Mugrem the Soul Devourer",
      "Kazj The Sentinel",
      "Promathiz",
      "Sentinel Shakorzeth",
      "Intercessor Razzra",
      "Gruukuuek the Elder"
    ];

    const rotation = bosses;
    const intervalHours = 2;
    // Set the startTime to match the provided rotation start time
    // August 5th, 18:00 PM UTC.
    const startTime = new Date("2025-08-05T18:00:00Z");

    // This will represent the real-world time at the top of the current or next hour.
    const now = new Date();
    const nextSpawnTime = new Date(now);
    nextSpawnTime.setMinutes(0);
    nextSpawnTime.setSeconds(0);
    nextSpawnTime.setMilliseconds(0);
    if (nextSpawnTime <= now) {
      nextSpawnTime.setHours(nextSpawnTime.getHours() + 1);
    }
    
    // Now, adjust to the nearest 2-hour interval
    const hoursFromStart = Math.floor((nextSpawnTime.getTime() - startTime.getTime()) / (1000 * 60 * 60));
    const hoursOffset = hoursFromStart % intervalHours;
    if (hoursOffset !== 0) {
      nextSpawnTime.setHours(nextSpawnTime.getHours() + (intervalHours - hoursOffset));
    }

    const bossList = document.getElementById("bossList");
    bosses.forEach(boss => {
      const id = boss.replace(/\s+/g, "_");
      bossList.innerHTML += `
        <label><input type="checkbox" id="${id}" /> ${boss}</label>
      `;
    });

    const output = document.getElementById("output");

    function calculateSpawns() {
      output.innerHTML = "";

      const completed = new Set();
      bosses.forEach(boss => {
        const id = boss.replace(/\s+/g, "_");
        if (document.getElementById(id).checked) {
          completed.add(boss);
        }
      });

      // Calculate the current position in the rotation based on the real-world time
      const totalHoursElapsed = Math.floor((nextSpawnTime.getTime() - startTime.getTime()) / (1000 * 60 * 60));
      const startingRotationIndex = totalHoursElapsed % rotation.length;

      const fullRotation = [];
      for (let i = 0; i < 84; i++) { // Generate enough entries for a week
        const spawnTime = new Date(nextSpawnTime.getTime() + i * intervalHours * 60 * 60 * 1000);
        const bossIndex = (startingRotationIndex + i) % rotation.length;
        const boss = rotation[bossIndex];
        fullRotation.push({ spawnTime, boss });
      }

      // Group by calendar day
      const groupedByDay = {};
      fullRotation.forEach((entry) => {
        const dateKey = entry.spawnTime.toDateString();
        if (!groupedByDay[dateKey]) {
          groupedByDay[dateKey] = [];
        }
        if (!completed.has(entry.boss)) {
          groupedByDay[dateKey].push(entry);
        }
      });

      // Sort by day and display the next 7 days
      const sortedDates = Object.keys(groupedByDay).sort((a, b) => new Date(a) - new Date(b));

      sortedDates.slice(0, 7).forEach((dateKey, dayIndex) => {
        const section = document.createElement("div");
        section.className = "day-box";

        const title = document.createElement("h3");
        const dateObj = new Date(dateKey);
        title.textContent = `Day ${dayIndex + 1} – ${dateObj.toLocaleDateString(undefined, {
          weekday: "short", month: "short", day: "numeric"
        })}`;
        section.appendChild(title);

        const list = document.createElement("ul");
        const entries = groupedByDay[dateKey].sort((a, b) => a.spawnTime - b.spawnTime);

        entries.forEach((entry, i) => {
          const li = document.createElement("li");
          li.textContent = `${entry.spawnTime.toLocaleTimeString(undefined, {
            hour: '2-digit',
            minute: '2-digit'
          })} — ${entry.boss}`;
          if (dayIndex === 0 && i === 0) li.classList.add("highlight");
          list.appendChild(li);
        });

        if (list.children.length > 0) {
          section.appendChild(list);
          output.appendChild(section);
        }
      });
    }

    document.querySelectorAll("input[type=checkbox]").forEach(input => {
      input.addEventListener("change", calculateSpawns);
    });

    calculateSpawns(); // initial run
  </script>
</body>
</html>
